# å…¬å¸å†…éƒ¨æµ‹è¯•å¹³å°

<cite>
**æœ¬æ–‡å¼•ç”¨çš„æ–‡ä»¶**
- [app.py](file://app.py)
- [config.py](file://config.py)
- [test_company_api.py](file://test_company_api.py)
- [requirements.txt](file://requirements.txt)
- [.env](file://.env)
- [utils/llm_client.py](file://utils/llm_client.py)
- [utils/stream_handler.py](file://utils/stream_handler.py)
- [utils/context_manager.py](file://utils/context_manager.py)
- [utils/state_manager.py](file://utils/state_manager.py)
- [utils/reference_manager.py](file://utils/reference_manager.py)
- [utils/text_analyzer.py](file://utils/text_analyzer.py)
- [utils/extractor.py](file://utils/extractor.py)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
3. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
4. [æ¶æ„æ€»è§ˆ](#æ¶æ„æ€»è§ˆ)
5. [è¯¦ç»†ç»„ä»¶åˆ†æ](#è¯¦ç»†ç»„ä»¶åˆ†æ)
6. [ä¾èµ–å…³ç³»åˆ†æ](#ä¾èµ–å…³ç³»åˆ†æ)
7. [æ€§èƒ½è€ƒé‡](#æ€§èƒ½è€ƒé‡)
8. [æ•…éšœæ’é™¤æŒ‡å—](#æ•…éšœæ’é™¤æŒ‡å—)
9. [ç»“è®º](#ç»“è®º)
10. [é™„å½•](#é™„å½•)

## ç®€ä»‹
æœ¬æ–‡ä»¶é¢å‘å…¬å¸å†…éƒ¨æµ‹è¯•å¹³å°çš„é›†æˆä¸ä½¿ç”¨ï¼Œé‡ç‚¹è¯´æ˜å¦‚ä½•åœ¨æœ¬é¡¹ç›®ä¸­é…ç½®ä¸ä½¿ç”¨å…¬å¸å†…éƒ¨çš„AIæµ‹è¯•APIæœåŠ¡ã€‚å†…å®¹æ¶µç›–ï¼š
- æƒé™ç”³è¯·ä¸è®¤è¯é…ç½®ï¼ˆAPI Tokenã€Base URLã€æ¨¡å‹é€‰æ‹©ï¼‰
- ä¸å¤–éƒ¨æœåŠ¡ï¼ˆå¦‚NewAPIã€SiliconFlowã€Geminiå®˜æ–¹ï¼‰çš„åŒºåˆ«ä¸é€‚ç”¨åœºæ™¯
- å†…ç½‘å®‰å…¨ä¸ç¨³å®šæ€§ä¿éšœç­‰å¹³å°ç‰¹ç‚¹
- å®Œæ•´é…ç½®ç¤ºä¾‹ä¸æµ‹è¯•è„šæœ¬ä½¿ç”¨æ–¹æ³•
- æ•…éšœæ’é™¤ä¸è°ƒè¯•æŠ€å·§

## é¡¹ç›®ç»“æ„
è¯¥é¡¹ç›®é‡‡ç”¨åŠŸèƒ½æ¨¡å—åŒ–ç»„ç»‡ï¼Œå›´ç»•Streamlitåº”ç”¨å…¥å£è¿›è¡ŒåŠŸèƒ½ç¼–æ’ï¼Œæ ¸å¿ƒé€»è¾‘é›†ä¸­åœ¨utilså­åŒ…ä¸­ï¼Œä¾¿äºå¤ç”¨ä¸æ‰©å±•ã€‚

```mermaid
graph TB
A["app.py<br/>Streamlit åº”ç”¨å…¥å£"] --> B["utils/llm_client.py<br/>ç»Ÿä¸€LLMå®¢æˆ·ç«¯"]
A --> C["utils/context_manager.py<br/>ä¸Šä¸‹æ–‡æ„å»º"]
A --> D["utils/state_manager.py<br/>çŠ¶æ€æŒä¹…åŒ–"]
A --> E["utils/reference_manager.py<br/>æ–‡é£å‚è€ƒ"]
A --> F["utils/text_analyzer.py<br/>å†²çªæ£€æµ‹"]
A --> G["utils/extractor.py<br/>å†…å®¹æå–"]
A --> H["utils/stream_handler.py<br/>æµå¼å¤„ç†"]
A --> I["config.py<br/>è·¯å¾„ä¸æ–‡ä»¶å¸¸é‡"]
A --> J[".env<br/>ç¯å¢ƒå˜é‡æ¨¡æ¿"]
A --> K["requirements.txt<br/>ä¾èµ–å£°æ˜"]
A --> L["test_company_api.py<br/>å¹³å°è¿é€šæ€§æµ‹è¯•è„šæœ¬"]
```

å›¾è¡¨æ¥æº
- [app.py](file://app.py#L1-L713)
- [utils/llm_client.py](file://utils/llm_client.py#L1-L203)
- [utils/context_manager.py](file://utils/context_manager.py#L1-L93)
- [utils/state_manager.py](file://utils/state_manager.py#L1-L77)
- [utils/reference_manager.py](file://utils/reference_manager.py#L1-L94)
- [utils/text_analyzer.py](file://utils/text_analyzer.py#L1-L63)
- [utils/extractor.py](file://utils/extractor.py#L1-L194)
- [utils/stream_handler.py](file://utils/stream_handler.py#L1-L114)
- [config.py](file://config.py#L1-L24)
- [.env](file://.env#L1-L16)
- [requirements.txt](file://requirements.txt#L1-L6)
- [test_company_api.py](file://test_company_api.py#L1-L25)

ç« èŠ‚æ¥æº
- [app.py](file://app.py#L1-L713)
- [config.py](file://config.py#L1-L24)

## æ ¸å¿ƒç»„ä»¶
- Streamlitåº”ç”¨å…¥å£ï¼šæä¾›ä¾§è¾¹æ é…ç½®é¢æ¿ä¸å¤šæ¨¡å¼åˆ›ä½œæµç¨‹ï¼ˆåˆå§‹åŒ–ã€æ¢è®¨è®¾å®šã€æ¢è®¨ç»†çº²ã€ç»­å†™æ­£æ–‡ã€æ”¹æ–‡ä¸å†²çªæç¤ºï¼‰ã€‚
- LLMå®¢æˆ·ç«¯ï¼šç»Ÿä¸€ç®¡ç†Geminiä¸OpenAIå…¼å®¹æ¥å£ï¼Œå†…ç½®å…¬å¸æµ‹è¯•å¹³å°ç‰¹ä¾‹å¤„ç†ä¸æµå¼å“åº”æ”¯æŒã€‚
- ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼šæ•´åˆè§’è‰²çŠ¶æ€ã€ä¼ç¬”ã€è®¾å®šä¸è¿‘æœŸç« èŠ‚ï¼Œæ„å»ºé«˜è´¨é‡æç¤ºè¯ã€‚
- çŠ¶æ€ç®¡ç†å™¨ï¼šè´Ÿè´£JSONæ–‡ä»¶çš„è¯»å†™ä¸å¿«ç…§ï¼Œæ”¯æ’‘å†²çªæ£€æµ‹ä¸å†å²è¿½è¸ªã€‚
- æ–‡é£å‚è€ƒä¸æ–‡æœ¬åˆ†æï¼šæä¾›å‚è€ƒæ®µè½æ£€ç´¢ä¸ç« èŠ‚é—´å†²çªæ‰«æã€‚
- å†…å®¹æå–å™¨ï¼šåŸºäºLLMè¿›è¡Œå…¨é‡/æµå¼æå–ï¼Œäº§å‡ºè§’è‰²çŠ¶æ€ã€ä¼ç¬”ã€è®¾å®šä¸å‰§æƒ…å›é¡¾ã€‚
- æµå¼å¤„ç†å™¨ï¼šè§£æSSEæµå¼å“åº”ï¼Œæ”¯æŒé•¿æ–‡æœ¬å®æ—¶å¢é‡è¾“å‡ºã€‚

ç« èŠ‚æ¥æº
- [app.py](file://app.py#L1-L713)
- [utils/llm_client.py](file://utils/llm_client.py#L1-L203)
- [utils/context_manager.py](file://utils/context_manager.py#L1-L93)
- [utils/state_manager.py](file://utils/state_manager.py#L1-L77)
- [utils/reference_manager.py](file://utils/reference_manager.py#L1-L94)
- [utils/text_analyzer.py](file://utils/text_analyzer.py#L1-L63)
- [utils/extractor.py](file://utils/extractor.py#L1-L194)
- [utils/stream_handler.py](file://utils/stream_handler.py#L1-L114)

## æ¶æ„æ€»è§ˆ
ä¸‹å›¾å±•ç¤ºåº”ç”¨ä¸LLMå®¢æˆ·ç«¯ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼Œä»¥åŠå…¬å¸æµ‹è¯•å¹³å°çš„ç‰¹ä¾‹åˆ†æ”¯ã€‚

```mermaid
sequenceDiagram
participant U as "ç”¨æˆ·ç•Œé¢<br/>app.py"
participant L as "LLMå®¢æˆ·ç«¯<br/>utils/llm_client.py"
participant P as "å…¬å¸æµ‹è¯•å¹³å°<br/>http : //45.78.235.165 : 9005/v1"
participant O as "OpenAIå…¼å®¹æœåŠ¡<br/>OpenAI SDK"
U->>L : "generate_content(æç¤ºè¯, æ¨¡å‹)"
alt "æä¾›å•†ä¸ºGemini"
L->>L : "configure() è®¾ç½® GOOGLE_API_KEY"
L-->>U : "è°ƒç”¨genaiç”Ÿæˆå†…å®¹"
else "æä¾›å•†ä¸ºOpenAIå…¼å®¹"
L->>L : "configure() æ£€æŸ¥ OPENAI_API_KEY"
alt "Base URLåŒ…å«å…¬å¸å¹³å°æ ‡è¯†"
L->>P : "POST /chat/completions (SSE/éæµå¼)"
P-->>L : "å“åº”(æµå¼/SSE)"
L-->>U : "è¿”å›å®Œæ•´æ–‡æœ¬"
else "æ ‡å‡†OpenAIå…¼å®¹æœåŠ¡"
L->>O : "chat.completions.create()"
O-->>L : "å“åº”"
L-->>U : "è¿”å›å†…å®¹"
end
end
```

å›¾è¡¨æ¥æº
- [app.py](file://app.py#L456-L460)
- [utils/llm_client.py](file://utils/llm_client.py#L9-L142)

## è¯¦ç»†ç»„ä»¶åˆ†æ

### å…¬å¸å†…éƒ¨æµ‹è¯•å¹³å°é…ç½®ä¸ä½¿ç”¨
- é€‰æ‹©æœåŠ¡å•†ï¼šåœ¨ä¾§è¾¹æ é€‰æ‹©â€œğŸ¢ å…¬å¸å†…éƒ¨æµ‹è¯•å¹³å°â€ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è®¾ç½®Base URLä¸æ¨¡å‹é€‰é¡¹ã€‚
- Base URLï¼šå›ºå®šä¸º http://45.78.235.165:9005/v1ï¼Œå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨è¡¥é½/chat/completionsç«¯ç‚¹ã€‚
- API Tokenï¼šæ”¯æŒå¸¦Bearerå‰ç¼€æˆ–ä¸å¸¦å‰ç¼€ä¸¤ç§å½¢å¼ï¼›ç³»ç»Ÿä¼šåŸæ ·é€ä¼ è‡³è¯·æ±‚å¤´ã€‚
- æ¨¡å‹é€‰æ‹©ï¼šæä¾›gemini-3-flash-previewã€deepseek-v3.2-251201-hsã€gpt-3.5-turboã€gpt-4ã€claude-3-haikuç­‰ã€‚
- ç‰¹æ®Šå¤„ç†ï¼šå½“æ£€æµ‹åˆ°å…¬å¸å¹³å°Base URLæ—¶ï¼Œå®¢æˆ·ç«¯é€šè¿‡requestsç›´è¿ï¼Œæ”¯æŒSSEæµå¼è¾“å‡ºä¸è¯¦ç»†é”™è¯¯æ—¥å¿—æ‰“å°ã€‚

```mermaid
flowchart TD
Start(["è¿›å…¥é…ç½®"]) --> Sel["é€‰æ‹©'å…¬å¸å†…éƒ¨æµ‹è¯•å¹³å°'"]
Sel --> SetBase["è®¾ç½®Base URL: http://45.78.235.165:9005/v1"]
SetBase --> SetToken["è¾“å…¥API Token(å¯å«Bearer)"]
SetToken --> SetModel["é€‰æ‹©æµ‹è¯•æ¨¡å‹"]
SetModel --> Apply["åº”ç”¨é…ç½®å¹¶ä¿å­˜åˆ°ç¯å¢ƒå˜é‡"]
Apply --> Test["è§¦å‘ä¸€æ¬¡generate_contentè°ƒç”¨"]
Test --> Resp{"å“åº”æˆåŠŸï¼Ÿ"}
Resp --> |æ˜¯| Done["å®Œæˆé…ç½®"]
Resp --> |å¦| Debug["æŸ¥çœ‹ç»ˆç«¯è¯¦ç»†é”™è¯¯æ—¥å¿—"]
Debug --> Done
```

å›¾è¡¨æ¥æº
- [app.py](file://app.py#L154-L196)
- [utils/llm_client.py](file://utils/llm_client.py#L52-L113)

ç« èŠ‚æ¥æº
- [app.py](file://app.py#L154-L196)
- [utils/llm_client.py](file://utils/llm_client.py#L52-L113)

### LLMå®¢æˆ·ç«¯è®¾è®¡ä¸å®ç°è¦ç‚¹
- ç»Ÿä¸€å…¥å£ï¼šgenerate_contentæ ¹æ®LLM_PROVIDERè‡ªåŠ¨åˆ‡æ¢Geminiæˆ–OpenAIå…¼å®¹è·¯å¾„ã€‚
- å…¼å®¹é€‚é…ï¼šOpenAIå…¼å®¹æ¨¡å¼ä¸‹ï¼Œè‹¥Base URLåŒ…å«å…¬å¸å¹³å°æ ‡è¯†ï¼Œåˆ™èµ°requestsç›´è¿ï¼›å¦åˆ™ä½¿ç”¨OpenAI SDKã€‚
- é”™è¯¯è¯Šæ–­ï¼šæ•è·å¼‚å¸¸å¹¶æ‰“å°æ¨¡å‹åã€å®Œæ•´URLã€API Keyé•¿åº¦ã€é”™è¯¯ç±»å‹ä¸å †æ ˆï¼Œä¾¿äºå¿«é€Ÿå®šä½é—®é¢˜ã€‚
- æµå¼æ”¯æŒï¼šé€šè¿‡stream_handlerè§£æSSEæµï¼Œé€‚ç”¨äºé•¿æ–‡æœ¬ç”Ÿæˆä¸å®æ—¶è¾“å‡ºã€‚

```mermaid
classDiagram
class LLMClient {
+configure()
+generate_content(prompt, model_name, stream)
+chat_with_model(history, new_message, model_name)
}
class StreamHandler {
+stream_response_handler(response)
+chunked_text_processor(text, chunk_size)
+streaming_extractor(text, model_name, chunk_size)
}
LLMClient --> StreamHandler : "ä½¿ç”¨"
```

å›¾è¡¨æ¥æº
- [utils/llm_client.py](file://utils/llm_client.py#L9-L142)
- [utils/stream_handler.py](file://utils/stream_handler.py#L1-L114)

ç« èŠ‚æ¥æº
- [utils/llm_client.py](file://utils/llm_client.py#L9-L142)
- [utils/stream_handler.py](file://utils/stream_handler.py#L1-L114)

### ä¸Šä¸‹æ–‡æ„å»ºä¸æç¤ºè¯å·¥ç¨‹
- ä¸Šä¸‹æ–‡æ¥æºï¼šè§’è‰²çŠ¶æ€ã€å¾…å›æ”¶ä¼ç¬”ã€è®¾å®šæ±‡æ€»ã€æœ€è¿‘Nç« æ­£æ–‡ã€‚
- æ„å»ºç­–ç•¥ï¼šæŒ‰æ¨¡å—æ‹¼æ¥ï¼Œå½¢æˆç»“æ„åŒ–æç¤ºè¯ï¼Œç¡®ä¿æ¨¡å‹å…·å¤‡å……åˆ†èƒŒæ™¯ä¿¡æ¯ã€‚
- ä½¿ç”¨åœºæ™¯ï¼šç»†çº²æ¢è®¨ã€æ­£æ–‡ç»­å†™ã€å†²çªæ£€æµ‹åˆ†æç­‰ã€‚

```mermaid
flowchart TD
Q["è¾“å…¥ä»»åŠ¡(Query)"] --> S["è¯»å–è§’è‰²çŠ¶æ€(JSON)"]
Q --> F["è¯»å–å¾…å›æ”¶ä¼ç¬”(JSON)"]
Q --> W["è¯»å–è®¾å®šæ±‡æ€»(TXT)"]
Q --> R["è¯»å–æœ€è¿‘Nç« æ­£æ–‡(TXT)"]
S --> P["æ‹¼æ¥ä¸ºæç¤ºè¯"]
F --> P
W --> P
R --> P
P --> O["è¾“å‡ºå®Œæ•´æç¤ºè¯"]
```

å›¾è¡¨æ¥æº
- [utils/context_manager.py](file://utils/context_manager.py#L43-L92)

ç« èŠ‚æ¥æº
- [utils/context_manager.py](file://utils/context_manager.py#L43-L92)

### çŠ¶æ€ç®¡ç†ä¸å†å²å¿«ç…§
- æ–‡ä»¶ç»“æ„ï¼šè§’è‰²çŠ¶æ€ä¸ä¼ç¬”åˆ†åˆ«å­˜å‚¨ä¸ºç‹¬ç«‹JSONæ–‡ä»¶ã€‚
- å¿«ç…§æœºåˆ¶ï¼šç« èŠ‚ä¿å­˜åå¯åˆ›å»ºçŠ¶æ€å¿«ç…§ï¼Œå‘½ååŒ…å«ç« èŠ‚åä¸æ—¶é—´æˆ³ï¼Œä¾¿äºå›æº¯ã€‚
- æ›´æ–°ç­–ç•¥ï¼šæ–°å¢ä¼ç¬”ä¸è§’è‰²çŠ¶æ€å˜æ›´æ—¶ï¼Œè‡ªåŠ¨åˆå¹¶å¹¶æŒä¹…åŒ–ã€‚

```mermaid
erDiagram
CHARACTER_STATE {
string name PK
json data
string last_updated_chapter
string updated_at
}
FORESHADOWING {
string id PK
string content
string chapter_created
string status
string chapter_resolved
string original_text_snippet
string created_at
}
HISTORY_SNAPSHOT {
string file_name PK
string chapter_name
string timestamp
}
```

å›¾è¡¨æ¥æº
- [utils/state_manager.py](file://utils/state_manager.py#L21-L76)

ç« èŠ‚æ¥æº
- [utils/state_manager.py](file://utils/state_manager.py#L21-L76)

### æ–‡é£å‚è€ƒä¸å†²çªæ£€æµ‹
- æ–‡é£å‚è€ƒï¼šè§£æâ€œå¤§ç¥ç´ ææ ·æœ¬.txtâ€ï¼Œæå–ç« èŠ‚æç¤ºä¸å…³é”®è¯ï¼Œæ”¯æŒåœ¨ç»­å†™æ—¶ä½œä¸ºæ–‡é£å‚è€ƒã€‚
- å†²çªæ£€æµ‹ï¼šå¯¹æ¯”ç¼–è¾‘å‰åæ–‡æœ¬å·®å¼‚ï¼Œæ‰«æåç»­ç« èŠ‚æ˜¯å¦ä»åŒ…å«è¢«åˆ é™¤çš„å…³é”®å­—ï¼Œè¾…åŠ©é¿å…æ˜¾å¼å†²çªã€‚

```mermaid
sequenceDiagram
participant U as "ç”¨æˆ·"
participant R as "å‚è€ƒç®¡ç†å™¨"
participant T as "æ–‡æœ¬åˆ†æå™¨"
participant M as "LLMå®¢æˆ·ç«¯"
U->>R : "é€‰æ‹©å‚è€ƒæ ·æœ¬"
R-->>U : "è¿”å›å‚è€ƒæ®µè½"
U->>T : "ä¿å­˜å¹¶æ£€æŸ¥å†²çª"
T->>T : "è®¡ç®—æ–‡æœ¬å·®å¼‚"
T->>T : "æ‰«æåç»­ç« èŠ‚å…³é”®å­—"
T-->>U : "è¿”å›å†²çªæ¸…å•"
U->>M : "è§¦å‘åˆ†æ(å¯é€‰)"
M-->>U : "è¿”å›åˆ†æç»“æœ"
```

å›¾è¡¨æ¥æº
- [utils/reference_manager.py](file://utils/reference_manager.py#L49-L93)
- [utils/text_analyzer.py](file://utils/text_analyzer.py#L39-L62)
- [app.py](file://app.py#L681-L712)

ç« èŠ‚æ¥æº
- [utils/reference_manager.py](file://utils/reference_manager.py#L49-L93)
- [utils/text_analyzer.py](file://utils/text_analyzer.py#L39-L62)
- [app.py](file://app.py#L681-L712)

### å†…å®¹æå–ä¸æµå¼å¤„ç†
- å…¨é‡æå–ï¼šä¸€æ¬¡æ€§æäº¤å…¨æ–‡ï¼Œè¿”å›è§’è‰²çŠ¶æ€ã€ä¼ç¬”ã€è®¾å®šä¸å‰§æƒ…å›é¡¾ã€‚
- æµå¼æå–ï¼šå°†é•¿æ–‡æœ¬åˆ†å—ï¼Œé€å—è°ƒç”¨æ¨¡å‹å¹¶åˆå¹¶ç»“æœï¼Œé™ä½å†…å­˜å ç”¨ã€‚
- ç»“æœä¿å­˜ï¼šè‡ªåŠ¨æ¸…æ´—JSONå¹¶å†™å…¥å¯¹åº”æ–‡ä»¶ï¼Œä¾¿äºåç»­ä½¿ç”¨ã€‚

```mermaid
flowchart TD
In["è¾“å…¥å®Œæ•´æ­£æ–‡"] --> Mode{"é€‰æ‹©æå–æ¨¡å¼"}
Mode --> |æ ‡å‡†| Full["ä¸€æ¬¡æ€§æå–"]
Mode --> |æµå¼| Chunk["åˆ†å—å¤„ç†"]
Full --> Clean["æ¸…æ´—JSONå¹¶è§£æ"]
Chunk --> Stream["é€å—è°ƒç”¨LLM(æµå¼)"]
Stream --> Merge["åˆå¹¶å—ç»“æœ"]
Clean --> Save["ä¿å­˜åˆ°æ–‡ä»¶"]
Merge --> Save
Save --> Out["è¿”å›ä¿å­˜æ¸…å•"]
```

å›¾è¡¨æ¥æº
- [utils/extractor.py](file://utils/extractor.py#L6-L193)
- [utils/stream_handler.py](file://utils/stream_handler.py#L58-L114)

ç« èŠ‚æ¥æº
- [utils/extractor.py](file://utils/extractor.py#L6-L193)
- [utils/stream_handler.py](file://utils/stream_handler.py#L58-L114)

## ä¾èµ–å…³ç³»åˆ†æ
- åº”ç”¨å±‚ä¾èµ–ï¼šapp.pyä¾èµ–utilså„æ¨¡å—ä¸configå¸¸é‡ï¼Œè´Ÿè´£UIä¸ä¸šåŠ¡æµç¨‹ç¼–æ’ã€‚
- å®¢æˆ·ç«¯ä¾èµ–ï¼šllm_clientä¾èµ–openaiä¸google-generativeaiï¼ŒåŒæ—¶åœ¨å…¬å¸å¹³å°åˆ†æ”¯ä½¿ç”¨requestsã€‚
- å·¥å…·é“¾ä¾èµ–ï¼šstream_handlerä¾èµ–llm_clientä¸jsonè§£æï¼Œextractorä¾èµ–llm_clientä¸state_managerã€‚
- ç¯å¢ƒä¾èµ–ï¼š.envæä¾›é»˜è®¤ç¤ºä¾‹ï¼Œrequirements.txtå£°æ˜è¿è¡Œæ‰€éœ€åŒ…ã€‚

```mermaid
graph TB
APP["app.py"] --> CFG["config.py"]
APP --> LLM["utils/llm_client.py"]
APP --> CTX["utils/context_manager.py"]
APP --> STM["utils/state_manager.py"]
APP --> REF["utils/reference_manager.py"]
APP --> TXT["utils/text_analyzer.py"]
APP --> EXT["utils/extractor.py"]
APP --> STR["utils/stream_handler.py"]
LLM --> REQ["requests"]
LLM --> OAI["openai"]
LLM --> GEN["google-generativeai"]
EXT --> STR
EXT --> STM
```

å›¾è¡¨æ¥æº
- [app.py](file://app.py#L1-L11)
- [utils/llm_client.py](file://utils/llm_client.py#L1-L4)
- [requirements.txt](file://requirements.txt#L1-L6)

ç« èŠ‚æ¥æº
- [app.py](file://app.py#L1-L11)
- [utils/llm_client.py](file://utils/llm_client.py#L1-L4)
- [requirements.txt](file://requirements.txt#L1-L6)

## æ€§èƒ½è€ƒé‡
- æµå¼å¤„ç†ï¼šåœ¨é•¿æ–‡æœ¬åœºæ™¯ä¸‹ï¼Œä¼˜å…ˆä½¿ç”¨æµå¼æå–ä¸æµå¼å“åº”ï¼Œå‡å°‘å†…å­˜å³°å€¼ä¸ç­‰å¾…æ—¶é—´ã€‚
- è¶…æ—¶ä¸é‡è¯•ï¼šOpenAI SDKä¸requestså‡è®¾ç½®è¾ƒé•¿è¶…æ—¶ï¼›llm_clientå¯¹å…³é”®è°ƒç”¨ä½¿ç”¨é‡è¯•è£…é¥°å™¨ï¼Œæå‡ç¨³å®šæ€§ã€‚
- æ¨¡å‹é€‰æ‹©ï¼šæ ¹æ®ä»»åŠ¡å¤æ‚åº¦é€‰æ‹©åˆé€‚æ¨¡å‹ï¼Œé¿å…ä¸å¿…è¦çš„é«˜æˆæœ¬æ¨ç†ã€‚
- ç›®å½•ä¸æ–‡ä»¶ï¼šç¡®ä¿å¿…è¦ç›®å½•ä¸æ–‡ä»¶å­˜åœ¨ï¼Œé¿å…è¿è¡Œæ—¶IOå¼€é”€ã€‚

## æ•…éšœæ’é™¤æŒ‡å—
- è®¤è¯å¤±è´¥
  - ç¡®è®¤OPENAI_API_KEYæˆ–GOOGLE_API_KEYå·²æ­£ç¡®è®¾ç½®ã€‚
  - å…¬å¸å¹³å°Tokenæ”¯æŒå¸¦Bearerå‰ç¼€ï¼Œç³»ç»Ÿä¼šåŸæ ·é€ä¼ ã€‚
- è¿æ¥è¶…æ—¶æˆ–ä¸ç¨³å®š
  - æ£€æŸ¥ç½‘ç»œä¸Base URLå¯è¾¾æ€§ã€‚
  - è°ƒæ•´æ¨¡å‹æˆ–é™ä½åˆ†å—å¤§å°ï¼Œå‡å°‘å•æ¬¡è¯·æ±‚è´Ÿè½½ã€‚
- å“åº”ä¸ºç©ºæˆ–é”™è¯¯
  - æŸ¥çœ‹ç»ˆç«¯æ‰“å°çš„è¯¦ç»†é”™è¯¯æ—¥å¿—ï¼ˆåŒ…å«æ¨¡å‹åã€å®Œæ•´URLã€API Keyé•¿åº¦ã€é”™è¯¯ç±»å‹ä¸å †æ ˆï¼‰ã€‚
  - å¯¹æ¯”.envä¸å®é™…è¿è¡Œç¯å¢ƒå˜é‡ï¼Œç¡®ä¿ä¸€è‡´ã€‚
- æµå¼è¾“å‡ºå¼‚å¸¸
  - ç¡®è®¤å¹³å°æ”¯æŒSSEä¸”æœªè¢«ä»£ç†/é˜²ç«å¢™æ‹¦æˆªã€‚
  - æ£€æŸ¥stream_handlerå¯¹SSEæ•°æ®å¸§çš„è§£æé€»è¾‘æ˜¯å¦åŒ¹é…å¹³å°å®ç°ã€‚
- ç¯å¢ƒå˜é‡ä¸é…ç½®
  - ä½¿ç”¨.test_company_api.pyè¿›è¡Œæœ€å°åŒ–éªŒè¯ï¼Œç¡®è®¤Base URLã€Tokenä¸æ¨¡å‹ç»„åˆå¯ç”¨ã€‚
  - å‚è€ƒ.envä¸­çš„æ³¨é‡Šç¤ºä¾‹ï¼ŒæŒ‰éœ€å–æ¶ˆæ³¨é‡Šå¹¶å¡«å†™çœŸå®å€¼ã€‚

ç« èŠ‚æ¥æº
- [utils/llm_client.py](file://utils/llm_client.py#L99-L113)
- [test_company_api.py](file://test_company_api.py#L1-L25)
- [.env](file://.env#L11-L15)

## ç»“è®º
æœ¬é¡¹ç›®æä¾›äº†å®Œæ•´çš„å…¬å¸å†…éƒ¨æµ‹è¯•å¹³å°é›†æˆæ–¹æ¡ˆï¼šé€šè¿‡ç»Ÿä¸€çš„LLMå®¢æˆ·ç«¯ä¸Streamlitç•Œé¢ï¼Œç”¨æˆ·å¯ä»¥ä¾¿æ·åœ°åˆ‡æ¢ä¸åŒæœåŠ¡å•†ã€é…ç½®API Tokenä¸æ¨¡å‹ï¼Œå¹¶åœ¨å¤šç§åˆ›ä½œåœºæ™¯ä¸­è·å¾—ç¨³å®šçš„AIæ”¯æŒã€‚å¹³å°å¼ºè°ƒå†…ç½‘å®‰å…¨ä¸å¯æ§æ€§ï¼Œç»“åˆè¯¦ç»†çš„é”™è¯¯æ—¥å¿—ä¸æµå¼å¤„ç†èƒ½åŠ›ï¼Œèƒ½å¤Ÿæ»¡è¶³æ—¥å¸¸åˆ›ä½œä¸å†…å®¹æå–çš„å¤šæ ·åŒ–éœ€æ±‚ã€‚

## é™„å½•

### é…ç½®ç¤ºä¾‹ä¸ä½¿ç”¨æ­¥éª¤
- åœ¨ä¾§è¾¹æ é€‰æ‹©â€œğŸ¢ å…¬å¸å†…éƒ¨æµ‹è¯•å¹³å°â€ï¼Œè®¾ç½®Base URLä¸API Tokenï¼Œé€‰æ‹©æ¨¡å‹å¹¶ä¿å­˜ã€‚
- æ‰“å¼€â€œåˆå§‹åŒ–â€é¡µé¢ï¼Œå¯ä¸€é”®åˆ›å»ºç›®å½•ç»“æ„ä¸ç©ºç™½çŠ¶æ€æ–‡ä»¶ã€‚
- ä½¿ç”¨â€œå…¨é‡çŠ¶æ€æå–â€åŠŸèƒ½ï¼Œé€‰æ‹©æ ‡å‡†æˆ–æµå¼æ¨¡å¼ï¼Œè§¦å‘AIåˆ†æå¹¶ä¿å­˜ç»“æœã€‚
- åœ¨â€œæ¢è®¨ç»†çº²/ç»­å†™æ­£æ–‡/æ”¹æ–‡ä¸å†²çªæç¤ºâ€ä¸­ï¼Œç»“åˆä¸Šä¸‹æ–‡ä¸çŠ¶æ€æ–‡ä»¶è¿›è¡Œåˆ›ä½œã€‚

ç« èŠ‚æ¥æº
- [app.py](file://app.py#L309-L418)
- [app.py](file://app.py#L500-L538)
- [app.py](file://app.py#L540-L620)
- [app.py](file://app.py#L622-L712)

### æµ‹è¯•è„šæœ¬ä½¿ç”¨æ–¹æ³•
- ä½¿ç”¨test_company_api.pyè¿›è¡Œæœ€å°åŒ–è¿é€šæ€§æµ‹è¯•ï¼ŒéªŒè¯Base URLã€æ¨¡å‹ä¸Tokenç»„åˆæ˜¯å¦æ­£ç¡®ã€‚
- è‹¥æµ‹è¯•å¤±è´¥ï¼Œä¾æ®ç»ˆç«¯æ‰“å°çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯è¿›è¡Œæ’æŸ¥ã€‚

ç« èŠ‚æ¥æº
- [test_company_api.py](file://test_company_api.py#L1-L25)